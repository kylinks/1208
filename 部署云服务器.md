# ğŸš€ é˜¿é‡Œäº‘æœåŠ¡å™¨éƒ¨ç½²å®Œæ•´æ•™ç¨‹

> Google Ads è”ç›Ÿé“¾æ¥è‡ªåŠ¨æ›´æ¢ç³»ç»Ÿ - éƒ¨ç½²æŒ‡å—

## ç›®å½•

1. [è´­ä¹°é˜¿é‡Œäº‘æœåŠ¡å™¨](#ç¬¬ä¸€éƒ¨åˆ†è´­ä¹°é˜¿é‡Œäº‘æœåŠ¡å™¨)
2. [è¿æ¥æœåŠ¡å™¨](#ç¬¬äºŒéƒ¨åˆ†è¿æ¥æœåŠ¡å™¨)
3. [å®‰è£…å¿…è¦è½¯ä»¶](#ç¬¬ä¸‰éƒ¨åˆ†å®‰è£…å¿…è¦è½¯ä»¶)
4. [ä¸Šä¼ é¡¹ç›®ä»£ç ](#ç¬¬å››éƒ¨åˆ†ä¸Šä¼ é¡¹ç›®ä»£ç )
5. [é…ç½®æ•°æ®åº“](#ç¬¬äº”éƒ¨åˆ†é…ç½®æ•°æ®åº“)
6. [éƒ¨ç½²é¡¹ç›®](#ç¬¬å…­éƒ¨åˆ†éƒ¨ç½²é¡¹ç›®)
7. [é…ç½® Nginx åå‘ä»£ç†](#ç¬¬ä¸ƒéƒ¨åˆ†é…ç½®-nginx-åå‘ä»£ç†)
8. [é…ç½®åŸŸåå’Œ HTTPS](#ç¬¬å…«éƒ¨åˆ†é…ç½®åŸŸåå’Œ-httpså¯é€‰)

---

## æœåŠ¡å™¨é…ç½®æ¨è

åŸºäº **50 ç”¨æˆ· Ã— 100 å¹¿å‘Šç³»åˆ—** çš„ä½¿ç”¨åœºæ™¯ï¼š

| é…ç½®é¡¹ | æ¨èé…ç½® | è¯´æ˜ |
|--------|----------|------|
| **CPU** | 4 æ ¸ | æ”¯æŒå¹¶å‘ç›‘æ§ä»»åŠ¡ |
| **å†…å­˜** | 8 GB | åº”ç”¨ 4GB + MySQL 4GB |
| **å­˜å‚¨** | 100 GB SSD | é¢„ç•™æ—¥å¿—å¢é•¿ç©ºé—´ |
| **å¸¦å®½** | 5-10 Mbps | |
| **ç³»ç»Ÿ** | Ubuntu 22.04 LTS | |
| **é¢„ç®—** | Â¥400-600/æœˆ | é˜¿é‡Œäº‘ ecs.c6.xlarge |

---

## ç¬¬ä¸€éƒ¨åˆ†ï¼šè´­ä¹°é˜¿é‡Œäº‘æœåŠ¡å™¨

### 1.1 æ³¨å†Œé˜¿é‡Œäº‘è´¦å·

1. è®¿é—® [é˜¿é‡Œäº‘å®˜ç½‘](https://www.aliyun.com/)
2. ç‚¹å‡»å³ä¸Šè§’ã€Œå…è´¹æ³¨å†Œã€
3. å®Œæˆæ‰‹æœºå·éªŒè¯å’Œå®åè®¤è¯ï¼ˆå¿…é¡»ï¼‰

### 1.2 è´­ä¹° ECS äº‘æœåŠ¡å™¨

1. ç™»å½•åï¼Œè¿›å…¥ã€Œäº§å“ã€â†’ã€Œäº‘æœåŠ¡å™¨ ECSã€â†’ã€Œç«‹å³è´­ä¹°ã€

2. **é€‰æ‹©é…ç½®**ï¼ˆæŒ‰ä»¥ä¸‹æ¨èé€‰æ‹©ï¼‰ï¼š

   | é…ç½®é¡¹ | æ¨èé€‰æ‹© |
   |--------|----------|
   | ä»˜è´¹æ¨¡å¼ | åŒ…å¹´åŒ…æœˆï¼ˆæ›´ä¾¿å®œï¼‰æˆ– æŒ‰é‡ä»˜è´¹ï¼ˆæµ‹è¯•ç”¨ï¼‰ |
   | åœ°åŸŸ | é€‰æ‹©ç¦»æ‚¨æœ€è¿‘çš„ï¼ˆå¦‚ï¼šåä¸œ1-æ­å·ï¼‰ |
   | å®ä¾‹è§„æ ¼ | ecs.c6.xlargeï¼ˆ4æ ¸8GBï¼‰æˆ– ecs.c6.largeï¼ˆ2æ ¸4GBï¼‰ |
   | é•œåƒ | **Ubuntu 22.04 64ä½** |
   | ç³»ç»Ÿç›˜ | SSDäº‘ç›˜ 100GB |
   | å¸¦å®½ | æŒ‰å›ºå®šå¸¦å®½ 5Mbps |

3. **è®¾ç½®ç™»å½•å‡­è¯**ï¼š
   - é€‰æ‹©ã€Œè‡ªå®šä¹‰å¯†ç ã€
   - è®¾ç½®ä¸€ä¸ª**å¼ºå¯†ç **ï¼ˆåŒ…å«å¤§å°å†™å­—æ¯ã€æ•°å­—ã€ç‰¹æ®Šç¬¦å·ï¼‰
   - âš ï¸ **åŠ¡å¿…è®°ä½è¿™ä¸ªå¯†ç ï¼**

4. ç‚¹å‡»ã€Œç¡®è®¤è®¢å•ã€â†’ã€Œæ”¯ä»˜ã€

### 1.3 é…ç½®å®‰å…¨ç»„ï¼ˆå¼€æ”¾ç«¯å£ï¼‰

è¿™ä¸€æ­¥**éå¸¸é‡è¦**ï¼Œå¦åˆ™æ— æ³•è®¿é—®ç½‘ç«™ï¼

1. è¿›å…¥ã€Œæ§åˆ¶å°ã€â†’ã€Œäº‘æœåŠ¡å™¨ ECSã€â†’ã€Œç½‘ç»œä¸å®‰å…¨ã€â†’ã€Œå®‰å…¨ç»„ã€
2. æ‰¾åˆ°æ‚¨çš„å®‰å…¨ç»„ï¼Œç‚¹å‡»ã€Œé…ç½®è§„åˆ™ã€â†’ã€Œå…¥æ–¹å‘ã€â†’ã€Œæ‰‹åŠ¨æ·»åŠ ã€
3. **æ·»åŠ ä»¥ä¸‹è§„åˆ™**ï¼š

   | ç«¯å£èŒƒå›´ | æˆæƒå¯¹è±¡ | æè¿° |
   |----------|----------|------|
   | 22/22 | 0.0.0.0/0 | SSH è¿œç¨‹è¿æ¥ |
   | 80/80 | 0.0.0.0/0 | HTTP ç½‘ç«™è®¿é—® |
   | 443/443 | 0.0.0.0/0 | HTTPS å®‰å…¨è®¿é—® |
   | 10111/10111 | 0.0.0.0/0 | Next.js åº”ç”¨ç«¯å£ |
   | 3306/3306 | 127.0.0.1/32 | MySQLï¼ˆä»…æœ¬æœºè®¿é—®ï¼‰ |

### 1.4 è·å–æœåŠ¡å™¨ IP åœ°å€

1. è¿›å…¥ã€Œæ§åˆ¶å°ã€â†’ã€Œäº‘æœåŠ¡å™¨ ECSã€â†’ã€Œå®ä¾‹ã€
2. æ‰¾åˆ°æ‚¨çš„æœåŠ¡å™¨ï¼Œè®°å½•ã€Œå…¬ç½‘ IPã€ï¼Œä¾‹å¦‚ï¼š`47.98.xxx.xxx`

---

## ç¬¬äºŒéƒ¨åˆ†ï¼šè¿æ¥æœåŠ¡å™¨

### 2.1 Windows ç”¨æˆ·

**æ–¹æ³•ä¸€ï¼šä½¿ç”¨ PowerShellï¼ˆæ¨èï¼‰**

1. æŒ‰ `Win + X`ï¼Œé€‰æ‹©ã€ŒWindows PowerShellã€æˆ–ã€Œç»ˆç«¯ã€
2. è¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼ˆæ›¿æ¢ä¸ºæ‚¨çš„ IPï¼‰ï¼š

```bash
ssh root@47.98.xxx.xxx
```

3. é¦–æ¬¡è¿æ¥è¾“å…¥ `yes` ç¡®è®¤
4. è¾“å…¥æ‚¨è®¾ç½®çš„å¯†ç ï¼ˆè¾“å…¥æ—¶ä¸æ˜¾ç¤ºï¼Œæ­£å¸¸ç°è±¡ï¼‰

**æ–¹æ³•äºŒï¼šä½¿ç”¨ FinalShellï¼ˆå›¾å½¢ç•Œé¢ï¼Œå¯¹å°ç™½æ›´å‹å¥½ï¼‰**

1. ä¸‹è½½ [FinalShell](http://www.hostbuf.com/t/988.html)
2. å®‰è£…å¹¶æ‰“å¼€
3. ç‚¹å‡»ã€Œæ–‡ä»¶å¤¹å›¾æ ‡ã€â†’ã€Œæ–°å»ºã€â†’ã€ŒSSHè¿æ¥ã€
4. å¡«å†™ï¼š
   - åç§°ï¼šéšæ„
   - ä¸»æœºï¼šæ‚¨çš„å…¬ç½‘ IP
   - ç«¯å£ï¼š22
   - ç”¨æˆ·åï¼šroot
   - å¯†ç ï¼šæ‚¨è®¾ç½®çš„å¯†ç 
5. ç‚¹å‡»ã€Œç¡®å®šã€ï¼ŒåŒå‡»è¿æ¥

### 2.2 Mac ç”¨æˆ·

1. æ‰“å¼€ã€Œç»ˆç«¯ã€åº”ç”¨ï¼ˆåœ¨å¯åŠ¨å°æœç´¢"ç»ˆç«¯"ï¼‰
2. è¾“å…¥å‘½ä»¤ï¼š

```bash
ssh root@47.98.xxx.xxx
```

3. é¦–æ¬¡è¿æ¥è¾“å…¥ `yes`
4. è¾“å…¥å¯†ç 

### 2.3 éªŒè¯è¿æ¥æˆåŠŸ

è¿æ¥æˆåŠŸåï¼Œæ‚¨ä¼šçœ‹åˆ°ç±»ä¼¼è¿™æ ·çš„æç¤ºï¼š

```
Welcome to Ubuntu 22.04 LTS
root@iZxxxxxxxx:~#
```

---

## ç¬¬ä¸‰éƒ¨åˆ†ï¼šå®‰è£…å¿…è¦è½¯ä»¶

ä»¥ä¸‹æ‰€æœ‰å‘½ä»¤éƒ½åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œï¼ˆé€šè¿‡ SSH è¿æ¥åï¼‰ã€‚

### 3.1 æ›´æ–°ç³»ç»Ÿ

```bash
apt update && apt upgrade -y
```

> ç­‰å¾… 1-2 åˆ†é’Ÿå®Œæˆ

### 3.2 å®‰è£… Node.js 20

```bash
# å®‰è£… NodeSource ä»“åº“
curl -fsSL https://deb.nodesource.com/setup_20.x | bash -

# å®‰è£… Node.js
apt install -y nodejs

# éªŒè¯å®‰è£…
node -v    # åº”è¯¥æ˜¾ç¤º v20.x.x
npm -v     # åº”è¯¥æ˜¾ç¤º 10.x.x
```

### 3.3 å®‰è£… MySQL 8.0

```bash
# å®‰è£… MySQL
apt install -y mysql-server

# å¯åŠ¨ MySQL
systemctl start mysql
systemctl enable mysql

# éªŒè¯è¿è¡ŒçŠ¶æ€
systemctl status mysql
```

> çœ‹åˆ° `active (running)` è¡¨ç¤ºæˆåŠŸ

**é…ç½® MySQL å®‰å…¨è®¾ç½®**ï¼š

```bash
mysql_secure_installation
```

æŒ‰ç…§æç¤ºæ“ä½œï¼š

```
- Would you like to setup VALIDATE PASSWORD component? â†’ nï¼ˆè¾“å…¥ nï¼‰
- New password: â†’ è¾“å…¥ä¸€ä¸ªæ•°æ®åº“å¯†ç ï¼ˆä¾‹å¦‚ï¼šMyDB@2024ï¼‰
- Re-enter new password: â†’ å†æ¬¡è¾“å…¥
- Remove anonymous users? â†’ y
- Disallow root login remotely? â†’ y
- Remove test database? â†’ y
- Reload privilege tables now? â†’ y
```

### 3.4 åˆ›å»ºæ•°æ®åº“å’Œç”¨æˆ·

```bash
# ç™»å½• MySQL
mysql -u root -p
```

è¾“å…¥åˆšæ‰è®¾ç½®çš„å¯†ç ï¼Œç„¶åæ‰§è¡Œä»¥ä¸‹ SQL å‘½ä»¤ï¼š

```sql
-- åˆ›å»ºæ•°æ®åº“ï¼ˆä½¿ç”¨ utf8mb4 æ”¯æŒä¸­æ–‡å’Œ emojiï¼‰
CREATE DATABASE google_ads_monitor CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

-- åˆ›å»ºå½±å­æ•°æ®åº“ï¼ˆPrisma è¿ç§»éœ€è¦ï¼‰
CREATE DATABASE google_ads_monitor_shadow CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

-- åˆ›å»ºä¸“ç”¨ç”¨æˆ·
CREATE USER 'adsuser'@'localhost' IDENTIFIED BY 'YourPassword@2024';

-- æˆæƒ
GRANT ALL PRIVILEGES ON google_ads_monitor.* TO 'adsuser'@'localhost';
GRANT ALL PRIVILEGES ON google_ads_monitor_shadow.* TO 'adsuser'@'localhost';

-- åˆ·æ–°æƒé™
FLUSH PRIVILEGES;

-- é€€å‡º
EXIT;
```

> âš ï¸ è¯·å°† `YourPassword@2024` æ›¿æ¢ä¸ºæ‚¨è‡ªå·±çš„å¼ºå¯†ç ï¼

### 3.5 å®‰è£… Nginx

```bash
apt install -y nginx

# å¯åŠ¨ Nginx
systemctl start nginx
systemctl enable nginx
```

åœ¨æµè§ˆå™¨è®¿é—® `http://æ‚¨çš„å…¬ç½‘IP`ï¼Œçœ‹åˆ° Nginx æ¬¢è¿é¡µé¢è¡¨ç¤ºæˆåŠŸã€‚

### 3.6 å®‰è£… PM2ï¼ˆè¿›ç¨‹ç®¡ç†å™¨ï¼‰

```bash
npm install -g pm2
```

### 3.7 å®‰è£… Git

```bash
apt install -y git
```

---

## ç¬¬å››éƒ¨åˆ†ï¼šä¸Šä¼ é¡¹ç›®ä»£ç 

### æ–¹æ³•ä¸€ï¼šä½¿ç”¨ Gitï¼ˆæ¨èï¼‰

å¦‚æœæ‚¨çš„ä»£ç åœ¨ GitHub/Giteeï¼š

```bash
# è¿›å…¥ç›®æ ‡ç›®å½•
cd /var/www

# å…‹éš†ä»£ç 
git clone https://github.com/æ‚¨çš„ç”¨æˆ·å/æ‚¨çš„ä»“åº“.git google-ads-monitor

# è¿›å…¥é¡¹ç›®ç›®å½•
cd google-ads-monitor
```

### æ–¹æ³•äºŒï¼šä½¿ç”¨ SFTP ä¸Šä¼ ï¼ˆé€‚åˆæœ¬åœ°ä»£ç ï¼‰

**å¦‚æœä½¿ç”¨ FinalShell**ï¼š

1. è¿æ¥æœåŠ¡å™¨åï¼Œä¸‹æ–¹ä¼šæ˜¾ç¤ºæ–‡ä»¶ç®¡ç†å™¨
2. è¿›å…¥ `/var/www` ç›®å½•
3. åˆ›å»ºæ–‡ä»¶å¤¹ `google-ads-monitor`
4. å°†æœ¬åœ°é¡¹ç›®æ–‡ä»¶æ‹–å…¥

**å¦‚æœä½¿ç”¨å‘½ä»¤è¡Œ**ï¼š

åœ¨**æœ¬åœ°ç”µè„‘**çš„ç»ˆç«¯æ‰§è¡Œï¼š

```bash
# å‹ç¼©é¡¹ç›®ï¼ˆæ’é™¤ node_modulesï¼‰
cd /path/to/your/project
tar --exclude='node_modules' --exclude='.next' -czvf project.tar.gz .

# ä¸Šä¼ åˆ°æœåŠ¡å™¨
scp project.tar.gz root@47.98.xxx.xxx:/var/www/

# è¿æ¥æœåŠ¡å™¨è§£å‹
ssh root@47.98.xxx.xxx
cd /var/www
mkdir google-ads-monitor
tar -xzvf project.tar.gz -C google-ads-monitor
rm project.tar.gz
```

---

## ç¬¬äº”éƒ¨åˆ†ï¼šé…ç½®æ•°æ®åº“

### 5.1 åˆ›å»ºç¯å¢ƒå˜é‡æ–‡ä»¶

```bash
cd /var/www/google-ads-monitor

# åˆ›å»º .env æ–‡ä»¶
nano .env
```

### 5.2 å¡«å†™ç¯å¢ƒå˜é‡

å¤åˆ¶ä»¥ä¸‹å†…å®¹åˆ° `.env` æ–‡ä»¶ï¼ˆæŒ‰ `Ctrl+Shift+V` ç²˜è´´ï¼‰ï¼š

```env
# æ•°æ®åº“é…ç½®ï¼ˆä¿®æ”¹ä¸ºæ‚¨çš„å¯†ç ï¼‰
DATABASE_URL="mysql://adsuser:YourPassword@2024@localhost:3306/google_ads_monitor"
SHADOW_DATABASE_URL="mysql://adsuser:YourPassword@2024@localhost:3306/google_ads_monitor_shadow"

# NextAuth é…ç½®
NEXTAUTH_URL="http://æ‚¨çš„å…¬ç½‘IP:10111"
NEXTAUTH_SECRET="è¯·ç”Ÿæˆä¸€ä¸ªéšæœºå­—ç¬¦ä¸²"

# Google Ads API é…ç½®ï¼ˆå¦‚æœéœ€è¦ï¼‰
GOOGLE_ADS_CLIENT_ID="æ‚¨çš„Client ID"
GOOGLE_ADS_CLIENT_SECRET="æ‚¨çš„Client Secret"
GOOGLE_ADS_DEVELOPER_TOKEN="æ‚¨çš„Developer Token"

# å…¶ä»–é…ç½®
NODE_ENV="production"
```

**ç”Ÿæˆ NEXTAUTH_SECRET**ï¼š

```bash
# åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œ
openssl rand -base64 32
```

å°†ç”Ÿæˆçš„éšæœºå­—ç¬¦ä¸²å¡«å…¥ `NEXTAUTH_SECRET`ã€‚

**ä¿å­˜å¹¶é€€å‡º**ï¼š

- æŒ‰ `Ctrl + X`
- æŒ‰ `Y` ç¡®è®¤ä¿å­˜
- æŒ‰ `Enter` ç¡®è®¤æ–‡ä»¶å

### 5.3 åˆå§‹åŒ–æ•°æ®åº“

```bash
# å®‰è£…é¡¹ç›®ä¾èµ–
npm install

# ç”Ÿæˆ Prisma å®¢æˆ·ç«¯
npm run db:generate

# æ¨é€æ•°æ®åº“ç»“æ„
npm run db:push

# è¿è¡Œç§å­æ•°æ®ï¼ˆåˆ›å»ºé»˜è®¤ç®¡ç†å‘˜è´¦å·ï¼‰
npm run db:seed
```

> å¦‚æœ `db:seed` æˆåŠŸï¼Œä¼šåˆ›å»ºä¸€ä¸ªé»˜è®¤ç®¡ç†å‘˜è´¦å·ï¼Œè¯·æŸ¥çœ‹ `prisma/seed.ts` æ–‡ä»¶äº†è§£é»˜è®¤è´¦å·å¯†ç ã€‚

---

## ç¬¬å…­éƒ¨åˆ†ï¼šéƒ¨ç½²é¡¹ç›®

### 6.1 æ„å»ºç”Ÿäº§ç‰ˆæœ¬

```bash
cd /var/www/google-ads-monitor

# æ„å»ºé¡¹ç›®
npm run build
```

> ç­‰å¾… 2-5 åˆ†é’Ÿï¼Œçœ‹åˆ° `âœ“ Compiled successfully` è¡¨ç¤ºæˆåŠŸ

### 6.2 ä½¿ç”¨ PM2 å¯åŠ¨é¡¹ç›®

```bash
# å¯åŠ¨é¡¹ç›®
pm2 start npm --name "google-ads" -- run start

# æŸ¥çœ‹è¿è¡ŒçŠ¶æ€
pm2 status
```

æ‚¨åº”è¯¥çœ‹åˆ°ç±»ä¼¼è¾“å‡ºï¼š

```
â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ id  â”‚ name         â”‚ namespace   â”‚ version â”‚ mode    â”‚ pid      â”‚
â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 0   â”‚ google-ads   â”‚ default     â”‚ N/A     â”‚ fork    â”‚ 12345    â”‚
â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.3 è®¾ç½® PM2 å¼€æœºè‡ªå¯

```bash
pm2 startup
pm2 save
```

### 6.4 éªŒè¯é¡¹ç›®è¿è¡Œ

åœ¨æµè§ˆå™¨è®¿é—®ï¼š`http://æ‚¨çš„å…¬ç½‘IP:10111`

å¦‚æœèƒ½çœ‹åˆ°ç™»å½•é¡µé¢ï¼Œæ­å–œæ‚¨ï¼é¡¹ç›®å·²æˆåŠŸè¿è¡Œï¼

### 6.5 å¸¸ç”¨ PM2 å‘½ä»¤

```bash
pm2 status              # æŸ¥çœ‹çŠ¶æ€
pm2 logs google-ads     # æŸ¥çœ‹æ—¥å¿—
pm2 restart google-ads  # é‡å¯é¡¹ç›®
pm2 stop google-ads     # åœæ­¢é¡¹ç›®
pm2 delete google-ads   # åˆ é™¤é¡¹ç›®
```

---

## ç¬¬ä¸ƒéƒ¨åˆ†ï¼šé…ç½® Nginx åå‘ä»£ç†

é…ç½® Nginx å¯ä»¥è®©æ‚¨é€šè¿‡ 80 ç«¯å£è®¿é—®ï¼ˆä¸ç”¨è¾“å…¥ :10111ï¼‰ã€‚

### 7.1 åˆ›å»º Nginx é…ç½®æ–‡ä»¶

```bash
nano /etc/nginx/sites-available/google-ads
```

### 7.2 å¡«å†™é…ç½®å†…å®¹

```nginx
server {
    listen 80;
    server_name æ‚¨çš„å…¬ç½‘IP;  # å¦‚æœæœ‰åŸŸåï¼Œæ”¹æˆåŸŸå

    # æ—¥å¿—
    access_log /var/log/nginx/google-ads.access.log;
    error_log /var/log/nginx/google-ads.error.log;

    # åå‘ä»£ç†åˆ° Next.js
    location / {
        proxy_pass http://127.0.0.1:10111;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
        
        # è¶…æ—¶è®¾ç½®
        proxy_connect_timeout 60s;
        proxy_send_timeout 60s;
        proxy_read_timeout 60s;
    }
}
```

ä¿å­˜é€€å‡ºï¼ˆ`Ctrl+X`ï¼Œ`Y`ï¼Œ`Enter`ï¼‰

### 7.3 å¯ç”¨é…ç½®

```bash
# åˆ›å»ºè½¯é“¾æ¥å¯ç”¨é…ç½®
ln -s /etc/nginx/sites-available/google-ads /etc/nginx/sites-enabled/

# åˆ é™¤é»˜è®¤é…ç½®ï¼ˆå¯é€‰ï¼‰
rm /etc/nginx/sites-enabled/default

# æµ‹è¯•é…ç½®è¯­æ³•
nginx -t

# é‡è½½ Nginx
systemctl reload nginx
```

### 7.4 éªŒè¯

ç°åœ¨å¯ä»¥ç›´æ¥è®¿é—®ï¼š`http://æ‚¨çš„å…¬ç½‘IP`ï¼ˆä¸éœ€è¦ç«¯å£å·äº†ï¼‰

---

## ç¬¬å…«éƒ¨åˆ†ï¼šé…ç½®åŸŸåå’Œ HTTPSï¼ˆå¯é€‰ï¼‰

### 8.1 è´­ä¹°åŸŸå

1. åœ¨é˜¿é‡Œäº‘æœç´¢ã€ŒåŸŸåæ³¨å†Œã€
2. é€‰æ‹©ä¸€ä¸ªåŸŸåè´­ä¹°ï¼ˆå¦‚ï¼š`yoursite.com`ï¼‰
3. å®Œæˆå®åè®¤è¯

### 8.2 åŸŸåè§£æ

1. è¿›å…¥ã€Œæ§åˆ¶å°ã€â†’ã€ŒåŸŸåã€â†’ã€Œè§£æã€
2. æ·»åŠ è®°å½•ï¼š
   - è®°å½•ç±»å‹ï¼šA
   - ä¸»æœºè®°å½•ï¼š@ï¼ˆæˆ– wwwï¼‰
   - è®°å½•å€¼ï¼šæ‚¨çš„æœåŠ¡å™¨å…¬ç½‘ IP

### 8.3 ä¿®æ”¹ Nginx é…ç½®

```bash
nano /etc/nginx/sites-available/google-ads
```

å°† `server_name` æ”¹ä¸ºæ‚¨çš„åŸŸåï¼š

```nginx
server_name yoursite.com www.yoursite.com;
```

### 8.4 å®‰è£… SSL è¯ä¹¦ï¼ˆå…è´¹ï¼‰

```bash
# å®‰è£… Certbot
apt install -y certbot python3-certbot-nginx

# ç”³è¯·è¯ä¹¦ï¼ˆè‡ªåŠ¨é…ç½®ï¼‰
certbot --nginx -d yoursite.com -d www.yoursite.com
```

æŒ‰æç¤ºè¾“å…¥é‚®ç®±ï¼ŒåŒæ„æ¡æ¬¾ï¼Œé€‰æ‹©æ˜¯å¦é‡å®šå‘ HTTP åˆ° HTTPSã€‚

### 8.5 æ›´æ–°ç¯å¢ƒå˜é‡

```bash
nano /var/www/google-ads-monitor/.env
```

ä¿®æ”¹ï¼š

```env
NEXTAUTH_URL="https://yoursite.com"
```

é‡å¯é¡¹ç›®ï¼š

```bash
pm2 restart google-ads
```

### 8.6 è‡ªåŠ¨ç»­æœŸè¯ä¹¦

Let's Encrypt è¯ä¹¦æœ‰æ•ˆæœŸ 90 å¤©ï¼ŒCertbot ä¼šè‡ªåŠ¨è®¾ç½®ç»­æœŸä»»åŠ¡ã€‚éªŒè¯ï¼š

```bash
certbot renew --dry-run
```

---

## ğŸ“‹ éƒ¨ç½²æ£€æŸ¥æ¸…å•

å®Œæˆéƒ¨ç½²åï¼Œè¯·é€é¡¹æ£€æŸ¥ï¼š

- [ ] èƒ½é€šè¿‡ IP æˆ–åŸŸåè®¿é—®ç½‘ç«™
- [ ] ç™»å½•é¡µé¢æ­£å¸¸æ˜¾ç¤º
- [ ] èƒ½æ­£å¸¸ç™»å½•ç³»ç»Ÿ
- [ ] æ•°æ®åº“è¿æ¥æ­£å¸¸ï¼ˆèƒ½çœ‹åˆ°é¡µé¢æ•°æ®ï¼‰
- [ ] PM2 æ˜¾ç¤ºé¡¹ç›®è¿è¡Œä¸­ (`pm2 status`)
- [ ] Nginx è¿è¡Œæ­£å¸¸ (`systemctl status nginx`)
- [ ] MySQL è¿è¡Œæ­£å¸¸ (`systemctl status mysql`)

---

## ğŸ”§ å¸¸è§é—®é¢˜æ’æŸ¥

### é—®é¢˜ 1ï¼šç½‘ç«™æ‰“ä¸å¼€

```bash
# æ£€æŸ¥é¡¹ç›®æ˜¯å¦è¿è¡Œ
pm2 status

# æŸ¥çœ‹é¡¹ç›®æ—¥å¿—
pm2 logs google-ads --lines 50

# æ£€æŸ¥ç«¯å£æ˜¯å¦è¢«å ç”¨
netstat -tlnp | grep 10111
```

### é—®é¢˜ 2ï¼šæ•°æ®åº“è¿æ¥å¤±è´¥

```bash
# æµ‹è¯•æ•°æ®åº“è¿æ¥
mysql -u adsuser -p google_ads_monitor

# æ£€æŸ¥ .env æ–‡ä»¶
cat /var/www/google-ads-monitor/.env | grep DATABASE
```

### é—®é¢˜ 3ï¼š502 Bad Gateway

```bash
# æ£€æŸ¥ Next.js æ˜¯å¦è¿è¡Œ
pm2 status

# é‡å¯é¡¹ç›®
pm2 restart google-ads

# æ£€æŸ¥ Nginx æ—¥å¿—
tail -f /var/log/nginx/google-ads.error.log
```

### é—®é¢˜ 4ï¼šæƒé™é—®é¢˜

```bash
# ä¿®å¤é¡¹ç›®ç›®å½•æƒé™
chown -R www-data:www-data /var/www/google-ads-monitor
chmod -R 755 /var/www/google-ads-monitor
```

### é—®é¢˜ 5ï¼šå†…å­˜ä¸è¶³

```bash
# æŸ¥çœ‹å†…å­˜ä½¿ç”¨
free -h

# åˆ›å»º swap åˆ†åŒºï¼ˆå¦‚æœå†…å­˜ä¸è¶³ï¼‰
fallocate -l 2G /swapfile
chmod 600 /swapfile
mkswap /swapfile
swapon /swapfile
echo '/swapfile none swap sw 0 0' >> /etc/fstab
```

### é—®é¢˜ 6ï¼šæ„å»ºå¤±è´¥

```bash
# æ¸…ç†å¹¶é‡æ–°æ„å»º
rm -rf .next node_modules
npm install
npm run build
```

---

## ğŸ“ ç»´æŠ¤å‘½ä»¤é€ŸæŸ¥è¡¨

| æ“ä½œ | å‘½ä»¤ |
|------|------|
| æŸ¥çœ‹é¡¹ç›®çŠ¶æ€ | `pm2 status` |
| æŸ¥çœ‹å®æ—¶æ—¥å¿— | `pm2 logs google-ads` |
| é‡å¯é¡¹ç›® | `pm2 restart google-ads` |
| åœæ­¢é¡¹ç›® | `pm2 stop google-ads` |
| é‡å¯ Nginx | `systemctl restart nginx` |
| é‡å¯ MySQL | `systemctl restart mysql` |
| æ›´æ–°ä»£ç åé‡æ–°éƒ¨ç½² | `git pull && npm install && npm run build && pm2 restart google-ads` |
| æŸ¥çœ‹æœåŠ¡å™¨èµ„æº | `htop` æˆ– `top` |
| æŸ¥çœ‹ç£ç›˜ç©ºé—´ | `df -h` |
| æŸ¥çœ‹å†…å­˜ | `free -h` |
| æŸ¥çœ‹ CPU | `lscpu` |

---

## ğŸ”„ ä»£ç æ›´æ–°æµç¨‹

å½“éœ€è¦æ›´æ–°ä»£ç æ—¶ï¼š

```bash
cd /var/www/google-ads-monitor

# 1. æ‹‰å–æœ€æ–°ä»£ç ï¼ˆå¦‚æœä½¿ç”¨ Gitï¼‰
git pull origin main

# 2. å®‰è£…æ–°ä¾èµ–
npm install

# 3. æ›´æ–°æ•°æ®åº“ï¼ˆå¦‚æœæœ‰å˜æ›´ï¼‰
npm run db:generate
npm run db:push

# 4. é‡æ–°æ„å»º
npm run build

# 5. é‡å¯é¡¹ç›®
pm2 restart google-ads
```

---

## ğŸ“Š ç›‘æ§ä¸æ—¥å¿—

### æŸ¥çœ‹åº”ç”¨æ—¥å¿—

```bash
# å®æ—¶æŸ¥çœ‹
pm2 logs google-ads

# æŸ¥çœ‹æœ€è¿‘ 100 è¡Œ
pm2 logs google-ads --lines 100

# æ—¥å¿—æ–‡ä»¶ä½ç½®
ls ~/.pm2/logs/
```

### æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—

```bash
# Nginx è®¿é—®æ—¥å¿—
tail -f /var/log/nginx/google-ads.access.log

# Nginx é”™è¯¯æ—¥å¿—
tail -f /var/log/nginx/google-ads.error.log

# MySQL é”™è¯¯æ—¥å¿—
tail -f /var/log/mysql/error.log
```

### æœåŠ¡å™¨ç›‘æ§

```bash
# å®‰è£… htopï¼ˆæ›´å¥½çš„ topï¼‰
apt install -y htop

# æŸ¥çœ‹èµ„æºä½¿ç”¨
htop
```

---

## ğŸ‰ éƒ¨ç½²å®Œæˆ

æ­å–œæ‚¨ï¼å®Œæˆä»¥ä¸Šæ­¥éª¤åï¼Œæ‚¨çš„ Google Ads è”ç›Ÿé“¾æ¥è‡ªåŠ¨æ›´æ¢ç³»ç»Ÿå°±å·²ç»æˆåŠŸéƒ¨ç½²åˆ°é˜¿é‡Œäº‘æœåŠ¡å™¨äº†ã€‚

å¦‚æœ‰ä»»ä½•é—®é¢˜ï¼Œè¯·å‚è€ƒä¸Šæ–¹çš„ã€Œå¸¸è§é—®é¢˜æ’æŸ¥ã€éƒ¨åˆ†ï¼Œæˆ–æŸ¥é˜…é¡¹ç›®å…¶ä»–æ–‡æ¡£ã€‚
